<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pedidos NIA</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007bff">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
            font-weight: 300;
        }
        nav {
            margin-bottom: 30px;
            text-align: center;
        }
        nav button {
            margin: 0 8px 10px;
            padding: 12px 24px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        nav button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        nav button:active {
            transform: translateY(0);
        }
        .section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }
        .active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
            font-size: 14px;
        }
        th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        tr:nth-child(even) {
            background-color: #f8fafc;
        }
        tr:hover {
            background-color: #edf2f7;
            transition: background-color 0.2s ease;
        }
        input[type="text"], input[type="email"], input[type="number"], input[type="date"], input[type="file"] {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            width: 100%;
            box-sizing: border-box;
        }
        input[type="text"]:focus, input[type="email"]:focus, input[type="number"]:focus, input[type="date"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        button {
            padding: 10px 20px;
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        button:active {
            transform: translateY(0);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #4a5568;
        }
        .section h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-weight: 400;
        }
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { padding: 20px; }
            nav button { display: block; width: 100%; margin: 5px 0; }
            table { font-size: 12px; }
            th, td { padding: 8px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Sistema de Gestión de Pedidos de Inventario</h1>
        <nav>
            <button onclick="showSection('vendedores')">Vendedores</button>
            <button onclick="showSection('clientes')">Clientes</button>
            <button onclick="showSection('productos')">Productos</button>
            <button onclick="showSection('pedidos')">Pedidos</button>
            <button onclick="showSection('reportes')">Reportes</button>
            <button onclick="exportarDatos()">Exportar Datos</button>
            <input type="file" id="importFile" style="display:none" onchange="importarDatos()">
            <button onclick="document.getElementById('importFile').click()">Importar Datos</button>
            <button onclick="limpiarDatos()">Limpiar Datos</button>
        </nav>

        <div id="vendedores" class="section active">
            <h2>Administrar Vendedores</h2>
            <div class="form-group">
                <label>Nombre:</label>
                <input type="text" id="vendedorNombre">
                <button onclick="agregarVendedor()">Agregar</button>
            </div>
            <table id="tablaVendedores">
                <thead><tr><th>Nombre</th><th>Acciones</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <div id="clientes" class="section">
            <h2>Crear Nuevos Clientes</h2>
            <div class="form-group">
                <label>Nombre:</label>
                <input type="text" id="clienteNombre">
                <label>Email:</label>
                <input type="email" id="clienteEmail">
                <button onclick="agregarCliente()">Agregar</button>
            </div>
            <table id="tablaClientes">
                <thead><tr><th>Nombre</th><th>Email</th><th>Acciones</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <div id="productos" class="section">
            <h2>Productos e Inventario</h2>
            <input type="file" id="excelFile" accept=".xlsx,.xls,.csv">
            <button onclick="importarProductos()">Importar desde Excel</button>
            <table id="tablaProductos">
                <thead><tr><th>Codigo</th><th>Nombre</th><th>Cantidad</th><th>UltCosto</th><th>Precio</th><th>Precio2</th><th>Precio3</th><th>UniMed</th><th>Cod.Alterno</th><th>Acciones</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <div id="pedidos" class="section">
            <h2>Tomar Pedido</h2>
            <select id="vendedorSelect"></select>
            <select id="clienteSelect"></select>
            <div id="productosPedido"></div>
            <button onclick="guardarPedido()">Guardar Pedido</button>
        </div>

        <div id="reportes" class="section">
            <h2>Reportes de Transacciones</h2>
            <label>Fecha Inicio:</label>
            <input type="date" id="fechaInicio">
            <label>Fecha Fin:</label>
            <input type="date" id="fechaFin">
            <button onclick="generarReporte()">Descargar Reporte</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // Registro del Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('SW registrado'))
                .catch(err => console.log('Error SW', err));
        }

        let vendedores = JSON.parse(localStorage.getItem('vendedores')) || [];
        let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
        let productos = JSON.parse(localStorage.getItem('productos')) || [];
        let pedidos = JSON.parse(localStorage.getItem('pedidos')) || [];

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            if (sectionId === 'pedidos') cargarSelects();
            actualizarTablas();
        }

        function actualizarTablas() {
            actualizarTablaVendedores();
            actualizarTablaClientes();
            actualizarTablaProductos();
        }

        function actualizarTablaVendedores() {
            const tbody = document.querySelector('#tablaVendedores tbody');
            tbody.innerHTML = '';
            vendedores.forEach((v, i) => {
                tbody.innerHTML += `<tr><td>${v.nombre}</td><td><button onclick="eliminarVendedor(${i})">Eliminar</button></td></tr>`;
            });
        }

        function agregarVendedor() {
            const nombre = document.getElementById('vendedorNombre').value;
            if (nombre) {
                vendedores.push({ nombre });
                localStorage.setItem('vendedores', JSON.stringify(vendedores));
                document.getElementById('vendedorNombre').value = '';
                actualizarTablaVendedores();
            }
        }

        function eliminarVendedor(i) {
            vendedores.splice(i, 1);
            localStorage.setItem('vendedores', JSON.stringify(vendedores));
            actualizarTablaVendedores();
        }

        function actualizarTablaClientes() {
            const tbody = document.querySelector('#tablaClientes tbody');
            tbody.innerHTML = '';
            clientes.forEach((c, i) => {
                tbody.innerHTML += `<tr><td>${c.nombre}</td><td>${c.email}</td><td><button onclick="eliminarCliente(${i})">Eliminar</button></td></tr>`;
            });
        }

        function agregarCliente() {
            const nombre = document.getElementById('clienteNombre').value;
            const email = document.getElementById('clienteEmail').value;
            if (nombre && email) {
                clientes.push({ nombre, email });
                localStorage.setItem('clientes', JSON.stringify(clientes));
                document.getElementById('clienteNombre').value = '';
                document.getElementById('clienteEmail').value = '';
                actualizarTablaClientes();
            }
        }

        function eliminarCliente(i) {
            clientes.splice(i, 1);
            localStorage.setItem('clientes', JSON.stringify(clientes));
            actualizarTablaClientes();
        }

        function actualizarTablaProductos() {
            const tbody = document.querySelector('#tablaProductos tbody');
            tbody.innerHTML = '';
            productos.forEach((p, i) => {
                tbody.innerHTML += `<tr><td>${p.codigo}</td><td>${p.nombre}</td><td><input type="number" value="${p.cantidad}" onchange="actualizarCantidad(${i}, this.value)"></td><td>${p.ultcosto}</td><td>${p.precio}</td><td>${p.precio2}</td><td>${p.precio3}</td><td>${p.unimed}</td><td>${p.codalterno}</td><td><button onclick="eliminarProducto(${i})">Eliminar</button></td></tr>`;
            });
        }

        function actualizarCantidad(i, nuevaCantidad) {
            productos[i].cantidad = parseInt(nuevaCantidad);
            localStorage.setItem('productos', JSON.stringify(productos));
        }

        function eliminarProducto(i) {
            productos.splice(i, 1);
            localStorage.setItem('productos', JSON.stringify(productos));
            actualizarTablaProductos();
        }

        function importarProductos() {
            const file = document.getElementById('excelFile').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const json = XLSX.utils.sheet_to_json(worksheet);
                    if (json.length > 0) {
                        alert('Columnas encontradas en el archivo: ' + Object.keys(json[0]).join(', '));
                    }
                    productos = productos.concat(json.map(row => ({
                        codigo: row.Codigo || row.codigo || '',
                        nombre: row.Nombre || row.nombre || row.Name || row.name || row.Producto || row.producto || row.Articulo || row.articulo || row.Item || row.item || row['Descripción'] || row['descripción'] || row['Nombre Producto'] || row['nombre producto'] || row['Descripción Producto'] || row['descripción producto'] || row.Descripcion || row.descripcion || row.Codigo || row.codigo || 'Sin Nombre',
                        cantidad: row.Cantidad || row.cantidad || row.Quantity || row.quantity || row.Stock || row.stock || row.Disponible || row.disponible || row.Qty || row.qty || row['Cantidad Disponible'] || row['cantidad disponible'] || row['Stock Disponible'] || row['stock disponible'] || 0,
                        precio: row.Precio || row.precio || row.Price || row.price || row.Costo || row.costo || row.Valor || row.valor || row['Precio Unitario'] || row['precio unitario'] || row['Costo Unitario'] || row['costo unitario'] || row.Precio1 || row.precio1 || row.UltCosto || row.ultcosto || 0,
                        unimed: row.UniMed || row.unimed || row['Uni Med'] || row['uni med'] || '',
                        precio2: row.Precio2 || row.precio2 || 0,
                        precio3: row.Precio3 || row.precio3 || 0,
                        ultcosto: row.UltCosto || row.ultcosto || 0,
                        codalterno: row['Cod.Alterno'] || row['cod.alterno'] || row['Cod Alterno'] || row['cod alterno'] || ''
                    })));
                    localStorage.setItem('productos', JSON.stringify(productos));
                    actualizarTablaProductos();
                };
                reader.readAsArrayBuffer(file);
            }
        }

        function cargarSelects() {
            const vendedorSelect = document.getElementById('vendedorSelect');
            const clienteSelect = document.getElementById('clienteSelect');
            vendedorSelect.innerHTML = '<option>Seleccionar Vendedor</option>' + vendedores.map((v, i) => `<option value="${i}">${v.nombre}</option>`).join('');
            clienteSelect.innerHTML = '<option>Seleccionar Cliente</option>' + clientes.map((c, i) => `<option value="${i}">${c.nombre}</option>`).join('');
            const productosDiv = document.getElementById('productosPedido');
            productosDiv.innerHTML = productos.map((p, i) => `<div><label>${p.nombre} (Disponible: ${p.cantidad})</label><input type="number" id="prod${i}" min="0" max="${p.cantidad}"></div>`).join('');
        }

        function guardarPedido() {
            const vendedorIndex = document.getElementById('vendedorSelect').value;
            const clienteIndex = document.getElementById('clienteSelect').value;
            if (vendedorIndex && clienteIndex) {
                const items = productos.map((p, i) => {
                    const qty = parseInt(document.getElementById(`prod${i}`).value) || 0;
                    if (qty > 0) {
                        productos[i].cantidad -= qty;
                        return { nombre: p.nombre, cantidad: qty, precio: p.precio };
                    }
                    return null;
                }).filter(item => item);
                if (items.length > 0) {
                    pedidos.push({
                        vendedor: vendedores[vendedorIndex].nombre,
                        cliente: clientes[clienteIndex].nombre,
                        items,
                        fecha: new Date().toISOString()
                    });
                    localStorage.setItem('pedidos', JSON.stringify(pedidos));
                    localStorage.setItem('productos', JSON.stringify(productos));
                    alert('Pedido guardado');
                    showSection('pedidos');
                }
            }
        }

        function exportarDatos() {
            const data = {
                vendedores,
                clientes,
                productos,
                pedidos
            };
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'datos.json';
            a.click();
        }

        function limpiarDatos() {
            if (confirm('¿Estás seguro de que quieres limpiar todos los productos y pedidos? Esta acción no se puede deshacer.')) {
                productos = [];
                pedidos = [];
                localStorage.setItem('productos', JSON.stringify(productos));
                localStorage.setItem('pedidos', JSON.stringify(pedidos));
                actualizarTablas();
                alert('Datos de productos y pedidos limpiados.');
            }
        }

        // Inicializar
        actualizarTablas();
    </script>
</body>
</html>